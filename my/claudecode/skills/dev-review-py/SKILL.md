---
name: dev-review-py
description: 对未提交的 Python 代码更改进行全面的安全和质量审查
disable-model-invocation: true
---

# Python Code Review

对未提交的 Python 代码更改进行全面的安全和质量审查：

1. 获取更改的文件：git diff --name-only HEAD

2. 对每个更改的 .py 文件检查：

**安全问题（关键）：**
- 硬编码凭证、API 密钥、令牌
- SQL 注入漏洞（f-string 拼接查询）
- XSS 漏洞（未转义的用户输入）
- 缺少输入验证
- 不安全的依赖项（过时的包）
- 路径遍历风险
- 不安全的反序列化（pickle、yaml）
- 不安全的正则表达式（ReDoS）

**代码质量（高）：**
- 函数超过 50 行
- 文件超过 800 行
- 嵌套深度超过 4 层
- 缺少错误处理或裸 except
- print() 调试语句
- 全局变量
- 违反 PEP 8 规范
- 缺少类型注解
- 使用 `import *`
- 新代码缺少测试

**最佳实践（中）：**
- 代码/注释中使用表情符号
- 没有关联工单的 TODO/FIXME
- 公共函数缺少 docstring
- 变量命名不当（x、tmp、data）
- 未解释的魔法数字
- 未使用的导入
- 过多的布尔参数

**性能（中）：**
- 不必要的列表复制（可用生成器）
- 用 + 拼接字符串而非 join
- 缺少 @lru_cache 缓存
- N+1 ORM 查询
- 循环中的重复计算

3. 生成报告，包含：
   - 严重程度：关键、高、中、低
   - 文件位置和行号
   - 问题描述
   - 建议修复方案

4. 如果发现关键或高优先级问题，阻止提交

绝不批准有安全漏洞的代码！
