---
name: dev-build-fix-py
description: 在 Python 项目构建或打包失败时，按文件分组逐条修复错误，每次变更后重新构建验证，三次无效或引入新错误即停止。
---

# Dev Build Fix (Py)

用于 Python 项目的构建/打包失败修复流程，强调最小改动、逐条验证与清晰汇总。

## 何时使用

- 构建或打包失败（如 `python -m build`、`poetry build`、`uv build`）
- 拉取新代码后无法构建发布产物
- 需要在 CI 之前快速恢复构建

## 工作流程（严格顺序）

1. 确认构建命令
   - 优先阅读项目文档或现有脚本（`Makefile`/`pyproject.toml`/`setup.cfg`/`setup.py`）
   - 若存在 `Makefile` 的 `build` 目标，优先使用 `make build`
   - 若项目使用 Poetry/uv 等工具，使用其标准构建命令
   - 若缺少明确信息，先向用户确认
2. 运行构建
   - 使用上一步确认的构建命令
3. 解析错误输出
   - 按文件分组
   - 按严重度排序
4. 针对单个错误循环
   - 展示错误上下文（前后 5 行）
   - 解释问题成因
   - 提出修复方案
   - 施加最小改动
   - 重新运行构建
   - 验证该错误已消失
5. 停止条件
   - 修复引入新错误
   - 同一错误连续 3 次仍存在
   - 用户要求暂停

## 输出要求

- 已修复的错误
- 仍未解决的错误
- 新引入的错误（如有）

## 安全与约束

- 一次只修复一个错误
- 仅依据构建输出与上下文判断，不凭空猜测
- 变更保持最小化，避免跨模块隐式耦合
- 关键信息缺失时先向用户澄清
