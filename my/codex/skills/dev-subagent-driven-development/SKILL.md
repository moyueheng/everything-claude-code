---
name: dev-subagent-driven-development
description: 在当前会话中执行具有独立任务的实施计划时使用
---

# 子代理驱动开发

通过为每个任务分派新的子代理来执行计划，每个任务后进行两阶段审查：首先是规范合规性审查，然后是代码质量审查。

**核心原则：** 每个任务使用新的子代理 + 两阶段审查（规范然后是质量）= 高质量、快速迭代

## 何时使用

**vs. 执行计划（并行会话）：**
- 同一会话（无上下文切换）
- 每个任务使用新的子代理（无上下文污染）
- 每个任务后两阶段审查：首先是规范合规性，然后是代码质量
- 更快的迭代（任务之间无需人工介入）

## 流程

1. 读取计划，提取所有任务及完整文本，记录上下文，创建 TodoWrite
2. 对每个任务：
   - 分派实现者子代理（./implementer-prompt.md）
   - 实现者子代理提问？回答，提供上下文
   - 实现者子代理实现、测试、提交、自我审查
   - 分派规范审查者子代理（./spec-reviewer-prompt.md）
   - 规范审查者确认代码符合规范？
     - 否：实现者子代理修复规范差距
   - 分派代码质量审查者子代理（./code-quality-reviewer-prompt.md）
   - 代码质量审查者批准？
     - 否：实现者子代理修复质量问题
   - 在 TodoWrite 中标记任务完成
3. 还有任务剩余？返回步骤 2
4. 分派最终代码审查者子代理审查整个实现
5. 使用 superpowers:finishing-a-development-branch

## Prompt 模板

- `./implementer-prompt.md` - 分派实现者子代理
- `./spec-reviewer-prompt.md` - 分派规范合规性审查者子代理
- `./code-quality-reviewer-prompt.md` - 分派代码质量审查者子代理

## 示例工作流

```
你：我正在使用子代理驱动开发来执行此计划。

[读取计划文件一次：docs/plans/feature-plan.md]
[提取所有 5 个任务及完整文本和上下文]
[创建 TodoWrite 包含所有任务]

任务 1：Hook 安装脚本

[获取任务 1 文本和上下文（已提取）]
[分派实现子代理带完整任务文本 + 上下文]

实现者："开始前 - hook 应该在用户级别还是系统级别安装？"

你："用户级别 (~/.config/superpowers/hooks/)"

实现者："明白。正在实现..."
[稍后] 实现者：
  - 实现了 install-hook 命令
  - 添加了测试，5/5 通过
  - 自我审查：发现遗漏了 --force 标志，已添加
  - 已提交

[分派规范合规性审查者]
规范审查者：✅ 符合规范 - 满足所有需求，没有多余内容

[获取 git SHAs，分派代码质量审查者]
代码审查者：优点：测试覆盖好，代码清晰。问题：无。已批准。

[标记任务 1 完成]

任务 2：恢复模式

...

[所有任务后]
[分派最终代码审查者]
最终审查者：满足所有需求，准备合并

完成！
```

## 优点

**vs. 手动执行：**
- 子代理自然地遵循 TDD
- 每个任务全新上下文（无混淆）
- 并行安全（子代理不干扰）
- 子代理可以提问（工作前和工作中）

**vs. 执行计划：**
- 同一会话（无需交接）
- 持续进度（无需等待）
- 审查检查点自动

**效率提升：**
- 无文件读取开销（控制器提供完整文本）
- 控制器精心策划需要哪些上下文
- 子代理预先获得完整信息
- 工作前提出疑问（不是之后）

**质量门：**
- 自我审查在交接前发现问题
- 两阶段审查：规范合规性，然后是代码质量
- 审查循环确保修复实际有效
- 规范合规性防止过度/不足构建
- 代码质量确保实现构建良好

**成本：**
- 更多子代理调用（每个任务实现者 + 2 个审查者）
- 控制器做更多准备工作（预先提取所有任务）
- 审查循环增加迭代
- 但提前发现问题（比之后调试便宜）

## 红旗

**永远不要：**
- 没有明确用户同意在主分支上开始实施
- 跳过审查（规范合规性或代码质量）
- 继续执行未修复的问题
- 并行分派多个实现子代理（冲突）
- 让子代理读取计划文件（改为提供完整文本）
- 跳过场景设置上下文（子代理需要理解任务适合哪里）
- 忽略子代理问题（让他们继续前回答）
- 接受规范合规性"差不多"（规范审查者发现问题 = 未完成）
- 跳过审查循环（审查者发现问题 = 实现者修复 = 再次审查）
- 让实现者自我审查取代实际审查（两者都需要）
- **在规范合规性通过前开始代码质量审查**（顺序错误）
- 当任一审查有未解决问题时移动到下一个任务

**如果子代理提问：**
- 清晰完整地回答
- 如需提供额外上下文
- 不要催促他们进入实施

**如果审查者发现问题：**
- 实现者（同一子代理）修复它们
- 审查者再次审查
- 重复直到批准
- 不要跳过重新审查

**如果子代理任务失败：**
- 分派修复子代理带具体指令
- 不要尝试手动修复（上下文污染）

## 集成

**必需的工作流技能：**
- **superpowers:using-git-worktrees** - 必需：在开始前设置隔离工作区
- **superpowers:writing-plans** - 创建此技能执行的计划
- **superpowers:requesting-code-review** - 审查者子代理的代码审查模板
- **superpowers:finishing-a-development-branch** - 所有任务后完成开发

**子代理应该使用：**
- **superpowers:test-driven-development** - 子代理为每个任务遵循 TDD

**替代工作流：**
- **superpowers:executing-plans** - 用于并行会话而非同一会话执行
