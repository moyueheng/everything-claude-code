---
name: dev-requesting-review
description: 完成任务、实现主要功能或合并前使用 - 验证工作满足要求
---

# 请求代码审查

## 概述

分派代码审查子 agent 在问题级联前捕获它们。

**核心原则：** 早审查，常审查。

## 何时请求审查

**强制：**
- 子 agent 驱动开发中每个任务后
- 完成主要功能后
- 合并到 main 前

**可选但有价值：**
- 卡住时（新视角）
- 重构前（基线检查）
- 修复复杂 bug 后

## 如何请求

**1. 获取 git SHAs：**
```bash
BASE_SHA=$(git rev-parse HEAD~1)  # 或 origin/main
HEAD_SHA=$(git rev-parse HEAD)
```

**2. 分派代码审查子 agent：**

使用 Task 工具，填写模板：

**占位符：**
- `{实现内容}` - 你刚构建了什么
- `{计划或需求}` - 它应该做什么
- `{BASE_SHA}` - 起始提交
- `{HEAD_SHA}` - 结束提交
- `{描述}` - 简要总结

**3. 根据反馈行动：**
- 立即修复关键问题
- 继续前修复重要问题
- 记录次要问题稍后处理
- 如果审查者错了则反驳（带理由）

## 示例

```
[刚完成任务 2：添加验证函数]

你：让我在继续前请求代码审查。

BASE_SHA=$(git log --oneline | grep "Task 1" | head -1 | awk '{print $1}')
HEAD_SHA=$(git rev-parse HEAD)

[分派代码审查子 agent]
  实现内容: 对话索引的验证和修复函数
  计划或需求: docs/plans/deployment-plan.md 的任务 2
  BASE_SHA: a7981ec
  HEAD_SHA: 3df7661
  描述: 添加了 verifyIndex() 和 repairIndex()，支持 4 种问题类型

[子 agent 返回]：
  优点：架构清晰，真实测试
  问题：
    重要：缺少进度指示器
    次要：报告间隔的魔法数字 (100)
  评估：准备继续

你：[修复进度指示器]
[继续任务 3]
```

## 与工作流集成

**子 Agent 驱动开发：**
- 每个任务后审查
- 在问题复合前捕获
- 移动到下一个任务前修复

**执行计划：**
- 每批次（3 任务）后审查
- 获取反馈，应用，继续

**临时开发：**
- 合并前审查
- 卡住时审查

## 红旗

**绝不：**
- 因为"简单"跳过审查
- 忽略关键问题
- 未修复重要问题就继续
- 与有效技术反馈争论

**如果审查者错了：**
- 用技术理由反驳
- 展示证明有效的代码/测试
- 请求澄清
